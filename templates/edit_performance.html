<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Performance - {{ employee.full_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .edit-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .edit-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .metric-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .metric-section h5 {
            color: #667eea;
            margin-bottom: 20px;
            font-weight: 700;
        }
        .score-preview {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-width: 250px;
            z-index: 1000;
        }
        .score-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            position: relative;
        }
        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }
        .slider-container {
            margin-bottom: 25px;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .slider-value {
            color: #667eea;
            font-weight: 700;
        }
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }
        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        .btn-save:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .btn-auto {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        .btn-auto:hover {
            background: #218838;
            color: white;
        }
        .metric-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .breakdown-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        .breakdown-label {
            font-size: 0.85rem;
            color: #666;
        }
        .breakdown-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
        }
        .info-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .save-status {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 600;
            display: none;
            z-index: 2000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .save-status.success {
            background: #28a745;
            color: white;
        }
        .save-status.error {
            background: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="edit-container">
        <!-- Save Status Banner -->
        <div id="saveStatus" class="save-status"></div>

        <!-- Info Banner -->
        <div class="info-banner">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4><i class="fas fa-user-edit"></i> Editing Performance Metrics</h4>
                    <p class="mb-0">{{ employee.full_name }} ({{ employee.employee_id }}) - {{ current_month }}</p>
                    <small>{{ employee.department or 'No Department' }} | {{ employee.job_title or 'No Title' }}</small>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/performance/manage" class="btn btn-light">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <div class="col-lg-8">
                <form id="performanceForm">
                    <!-- Attendance Section -->
                    <div class="edit-card">
                        <div class="metric-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5><i class="fas fa-calendar-check"></i> Attendance Metrics</h5>
                                <button type="button" class="btn btn-auto btn-sm" onclick="autoCalculate('attendance')">
                                    <i class="fas fa-magic"></i> Auto Calculate
                                </button>
                            </div>

                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Attendance Score</span>
                                    <span class="slider-value" id="attendance_score_val">{{ metric.attendance_score }}</span>
                                </div>
                                <input type="range" id="attendance_score" name="attendance_score" 
                                       min="0" max="100" step="0.5" value="{{ metric.attendance_score }}"
                                       oninput="updateSlider(this)">
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Days Present</label>
                                    <input type="number" class="form-control" id="days_present" name="days_present" 
                                           value="{{ metric.days_present }}" min="0" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Total Working Days</label>
                                    <input type="number" class="form-control" id="days_total" name="days_total" 
                                           value="{{ metric.days_total }}" min="1" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Late Arrivals</label>
                                    <input type="number" class="form-control" id="late_arrivals" name="late_arrivals" 
                                           value="{{ metric.late_arrivals }}" min="0" onchange="markChanged()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Task Completion Section -->
                    <div class="edit-card">
                        <div class="metric-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5><i class="fas fa-tasks"></i> Task Completion Metrics</h5>
                                <button type="button" class="btn btn-auto btn-sm" onclick="autoCalculate('tasks')">
                                    <i class="fas fa-magic"></i> Auto Calculate
                                </button>
                            </div>

                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Task Completion Score</span>
                                    <span class="slider-value" id="task_completion_score_val">{{ metric.task_completion_score }}</span>
                                </div>
                                <input type="range" id="task_completion_score" name="task_completion_score" 
                                       min="0" max="100" step="0.5" value="{{ metric.task_completion_score }}"
                                       oninput="updateSlider(this)">
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Tasks Completed</label>
                                    <input type="number" class="form-control" id="tasks_completed" name="tasks_completed" 
                                           value="{{ metric.tasks_completed }}" min="0" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Tasks Assigned</label>
                                    <input type="number" class="form-control" id="tasks_assigned" name="tasks_assigned" 
                                           value="{{ metric.tasks_assigned }}" min="0" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">On-Time Completion %</label>
                                    <input type="number" class="form-control" id="on_time_completion" name="on_time_completion" 
                                           value="{{ metric.on_time_completion }}" min="0" max="100" step="0.1" onchange="markChanged()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quality Section -->
                    <div class="edit-card">
                        <div class="metric-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5><i class="fas fa-star"></i> Quality Metrics</h5>
                                <button type="button" class="btn btn-auto btn-sm" onclick="autoCalculate('quality')">
                                    <i class="fas fa-magic"></i> Auto Calculate
                                </button>
                            </div>

                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Quality Score</span>
                                    <span class="slider-value" id="quality_score_val">{{ metric.quality_score }}</span>
                                </div>
                                <input type="range" id="quality_score" name="quality_score" 
                                       min="0" max="100" step="0.5" value="{{ metric.quality_score }}"
                                       oninput="updateSlider(this)">
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Bug Rate %</label>
                                    <input type="number" class="form-control" id="bug_rate" name="bug_rate" 
                                           value="{{ metric.bug_rate }}" min="0" max="100" step="0.1" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Review Rating (0-5)</label>
                                    <input type="number" class="form-control" id="review_rating" name="review_rating" 
                                           value="{{ metric.review_rating }}" min="0" max="5" step="0.1" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Rework Required %</label>
                                    <input type="number" class="form-control" id="rework_required" name="rework_required" 
                                           value="{{ metric.rework_required }}" min="0" max="100" step="0.1" onchange="markChanged()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Punctuality Section -->
                    <div class="edit-card">
                        <div class="metric-section">
                            <h5><i class="fas fa-clock"></i> Punctuality Metrics</h5>

                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Punctuality Score</span>
                                    <span class="slider-value" id="punctuality_score_val">{{ metric.punctuality_score }}</span>
                                </div>
                                <input type="range" id="punctuality_score" name="punctuality_score" 
                                       min="0" max="100" step="0.5" value="{{ metric.punctuality_score }}"
                                       oninput="updateSlider(this)">
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Meeting Attendance %</label>
                                    <input type="number" class="form-control" id="meeting_attendance" name="meeting_attendance" 
                                           value="{{ metric.meeting_attendance }}" min="0" max="100" step="0.1" onchange="markChanged()">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Deadline Adherence %</label>
                                    <input type="number" class="form-control" id="deadline_adherence" name="deadline_adherence" 
                                           value="{{ metric.deadline_adherence }}" min="0" max="100" step="0.1" onchange="markChanged()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Collaboration Section -->
                    <div class="edit-card">
                        <div class="metric-section">
                            <h5><i class="fas fa-users"></i> Collaboration Metrics</h5>

                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Collaboration Score</span>
                                    <span class="slider-value" id="collaboration_score_val">{{ metric.collaboration_score }}</span>
                                </div>
                                <input type="range" id="collaboration_score" name="collaboration_score" 
                                       min="0" max="100" step="0.5" value="{{ metric.collaboration_score }}"
                                       oninput="updateSlider(this)">
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Peer Reviews</label>
                                    <input type="number" class="form-control" id="peer_reviews" name="peer_reviews" 
                                           value="{{ metric.peer_reviews }}" min="0" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Team Contributions</label>
                                    <input type="number" class="form-control" id="team_contributions" name="team_contributions" 
                                           value="{{ metric.team_contributions }}" min="0" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Communication Rating (0-5)</label>
                                    <input type="number" class="form-control" id="communication_rating" name="communication_rating" 
                                           value="{{ metric.communication_rating }}" min="0" max="5" step="0.1" onchange="markChanged()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Productivity Section -->
                    <div class="edit-card">
                        <div class="metric-section">
                            <h5><i class="fas fa-chart-bar"></i> Productivity Metrics</h5>

                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Productivity Score</span>
                                    <span class="slider-value" id="productivity_score_val">{{ metric.productivity_score }}</span>
                                </div>
                                <input type="range" id="productivity_score" name="productivity_score" 
                                       min="0" max="100" step="0.5" value="{{ metric.productivity_score }}"
                                       oninput="updateSlider(this)">
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Lines of Code</label>
                                    <input type="number" class="form-control" id="lines_of_code" name="lines_of_code" 
                                           value="{{ metric.lines_of_code }}" min="0" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Commits</label>
                                    <input type="number" class="form-control" id="commits" name="commits" 
                                           value="{{ metric.commits }}" min="0" onchange="markChanged()">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Story Points</label>
                                    <input type="number" class="form-control" id="story_points" name="story_points" 
                                           value="{{ metric.story_points }}" min="0" onchange="markChanged()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Section -->
                    <div class="edit-card">
                        <div class="metric-section">
                            <h5><i class="fas fa-sticky-note"></i> Additional Notes</h5>
                            <textarea class="form-control" id="notes" name="notes" rows="4" 
                                      placeholder="Add any additional notes or comments about performance..."
                                      onchange="markChanged()">{{ metric.notes or '' }}</textarea>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="text-center mb-4">
                        <button type="button" class="btn btn-save btn-lg me-3" onclick="savePerformance()">
                            <i class="fas fa-save"></i> Save All Changes
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="resetForm()">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                </form>
            </div>

            <!-- Live Score Preview (Sticky Sidebar) -->
            <div class="col-lg-4">
                <div class="score-preview">
                    <h5 class="text-center mb-3">Live Score Preview</h5>
                    
                    <div class="score-circle">
                        <svg width="120" height="120">
                            <circle cx="60" cy="60" r="54" stroke="#e0e0e0" stroke-width="12" fill="none"/>
                            <circle id="scoreCircle" cx="60" cy="60" r="54" stroke="url(#gradient)" stroke-width="12" 
                                    fill="none" stroke-linecap="round"
                                    style="stroke-dasharray: 339.292; stroke-dashoffset: 0; transform: rotate(-90deg); transform-origin: center;"/>
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="score-text" id="overallScore">{{ "%.1f"|format(metric.calculate_overall_score()) }}</div>
                    </div>

                    <div class="metric-breakdown">
                        <div class="breakdown-item">
                            <div class="breakdown-label">Attendance</div>
                            <div class="breakdown-value" id="preview_attendance">{{ "%.0f"|format(metric.attendance_score) }}</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-label">Tasks</div>
                            <div class="breakdown-value" id="preview_tasks">{{ "%.0f"|format(metric.task_completion_score) }}</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-label">Quality</div>
                            <div class="breakdown-value" id="preview_quality">{{ "%.0f"|format(metric.quality_score) }}</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-label">Punctuality</div>
                            <div class="breakdown-value" id="preview_punctuality">{{ "%.0f"|format(metric.punctuality_score) }}</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-label">Collaboration</div>
                            <div class="breakdown-value" id="preview_collaboration">{{ "%.0f"|format(metric.collaboration_score) }}</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-label">Productivity</div>
                            <div class="breakdown-value" id="preview_productivity">{{ "%.0f"|format(metric.productivity_score) }}</div>
                        </div>
                    </div>

                    <hr>
                    <div class="text-center">
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i> Updates in real-time as you edit
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let hasChanges = false;

        // Update slider display
        function updateSlider(slider) {
            const valueDisplay = document.getElementById(slider.id + '_val');
            valueDisplay.textContent = parseFloat(slider.value).toFixed(1);
            updateLivePreview();
            markChanged();
        }

        // Mark form as changed
        function markChanged() {
            hasChanges = true;
            updateLivePreview();
        }

        // Update live score preview
        function updateLivePreview() {
            const weights = {
                'attendance': 0.20,
                'task_completion': 0.25,
                'quality': 0.20,
                'punctuality': 0.15,
                'collaboration': 0.10,
                'productivity': 0.10
            };

            const scores = {
                'attendance': parseFloat(document.getElementById('attendance_score').value),
                'task_completion': parseFloat(document.getElementById('task_completion_score').value),
                'quality': parseFloat(document.getElementById('quality_score').value),
                'punctuality': parseFloat(document.getElementById('punctuality_score').value),
                'collaboration': parseFloat(document.getElementById('collaboration_score').value),
                'productivity': parseFloat(document.getElementById('productivity_score').value)
            };

            // Calculate overall score
            let overallScore = 0;
            for (let key in scores) {
                overallScore += scores[key] * weights[key];
            }

            // Update preview
            document.getElementById('overallScore').textContent = overallScore.toFixed(1);
            document.getElementById('preview_attendance').textContent = scores.attendance.toFixed(0);
            document.getElementById('preview_tasks').textContent = scores.task_completion.toFixed(0);
            document.getElementById('preview_quality').textContent = scores.quality.toFixed(0);
            document.getElementById('preview_punctuality').textContent = scores.punctuality.toFixed(0);
            document.getElementById('preview_collaboration').textContent = scores.collaboration.toFixed(0);
            document.getElementById('preview_productivity').textContent = scores.productivity.toFixed(0);

            // Update circle
            const circle = document.getElementById('scoreCircle');
            const circumference = 2 * Math.PI * 54;
            const offset = circumference - (overallScore / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        // Save performance data
        async function savePerformance() {
            const formData = {
                month: "{{ current_month }}",
                attendance_score: parseFloat(document.getElementById('attendance_score').value),
                days_present: parseInt(document.getElementById('days_present').value),
                days_total: parseInt(document.getElementById('days_total').value),
                late_arrivals: parseInt(document.getElementById('late_arrivals').value),
                task_completion_score: parseFloat(document.getElementById('task_completion_score').value),
                tasks_completed: parseInt(document.getElementById('tasks_completed').value),
                tasks_assigned: parseInt(document.getElementById('tasks_assigned').value),
                on_time_completion: parseFloat(document.getElementById('on_time_completion').value),
                quality_score: parseFloat(document.getElementById('quality_score').value),
                bug_rate: parseFloat(document.getElementById('bug_rate').value),
                review_rating: parseFloat(document.getElementById('review_rating').value),
                rework_required: parseFloat(document.getElementById('rework_required').value),
                punctuality_score: parseFloat(document.getElementById('punctuality_score').value),
                meeting_attendance: parseFloat(document.getElementById('meeting_attendance').value),
                deadline_adherence: parseFloat(document.getElementById('deadline_adherence').value),
                collaboration_score: parseFloat(document.getElementById('collaboration_score').value),
                peer_reviews: parseInt(document.getElementById('peer_reviews').value),
                team_contributions: parseInt(document.getElementById('team_contributions').value),
                communication_rating: parseFloat(document.getElementById('communication_rating').value),
                productivity_score: parseFloat(document.getElementById('productivity_score').value),
                lines_of_code: parseInt(document.getElementById('lines_of_code').value),
                commits: parseInt(document.getElementById('commits').value),
                story_points: parseInt(document.getElementById('story_points').value),
                notes: document.getElementById('notes').value
            };

            try {
                const response = await fetch('/api/performance/update/{{ employee.employee_id }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    showStatus('✓ Performance metrics saved successfully!', 'success');
                    hasChanges = false;
                    setTimeout(() => {
                        window.location.href = '/performance/manage';
                    }, 1500);
                } else {
                    showStatus('✗ Error: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Save error:', error);
                showStatus('✗ Network error. Please try again.', 'error');
            }
        }

        // Auto-calculate specific metrics
        async function autoCalculate(type) {
            try {
                const response = await fetch('/api/performance/auto-calculate/{{ employee.employee_id }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ month: "{{ current_month }}" })
                });

                const result = await response.json();

                if (result.success) {
                    // Update form with calculated values
                    document.getElementById('attendance_score').value = result.calculated_metrics.attendance_score;
                    document.getElementById('task_completion_score').value = result.calculated_metrics.task_completion_score;
                    document.getElementById('quality_score').value = result.calculated_metrics.quality_score;
                    document.getElementById('punctuality_score').value = result.calculated_metrics.punctuality_score;
                    document.getElementById('collaboration_score').value = result.calculated_metrics.collaboration_score;
                    document.getElementById('productivity_score').value = result.calculated_metrics.productivity_score;

                    // Update slider displays
                    document.querySelectorAll('input[type="range"]').forEach(slider => {
                        updateSlider(slider);
                    });

                    showStatus('✓ Metrics auto-calculated!', 'success');
                } else {
                    showStatus('✗ Auto-calculation failed', 'error');
                }
            } catch (error) {
                console.error('Auto-calculate error:', error);
                showStatus('✗ Network error', 'error');
            }
        }

        // Show save status
        function showStatus(message, type) {
            const status = document.getElementById('saveStatus');
            status.textContent = message;
            status.className = 'save-status ' + type;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        // Reset form
        function resetForm() {
            if (hasChanges && !confirm('Are you sure you want to reset? All unsaved changes will be lost.')) {
                return;
            }
            location.reload();
        }

        // Warn before leaving if there are unsaved changes
        window.addEventListener('beforeunload', (e) => {
            if (hasChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateLivePreview();
        });
    </script>
</body>
</html>